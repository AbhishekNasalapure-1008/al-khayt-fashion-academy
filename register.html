<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register - AL KHAYT Fashion Academy</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/responsive.css">
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container nav-container">
            <div class="logo">
                <img src="assets/images/logo.png" alt="AL KHAYT Fashion Academy Logo">
                <span>AL KHAYT Fashion Training Institute</span>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html">Home</a></li>
                <li><a href="courses.html">Courses</a></li>
                <li><a href="register.html" class="active">Register</a></li>
                <li><a href="rules.html">Rules</a></li>
            </ul>
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <h1>Student Registration</h1>
            <p>Begin your fashion journey with us</p>
        </div>
    </section>

    <!-- Registration Form -->
    <section class="registration-section">
        <div class="container">
            <div class="form-container">
                <form id="registrationForm" class="registration-form">
                    <div class="form-section">
                        <h2>Personal Information</h2>

                        <div class="form-group">
                            <label for="fullname">Full Name *</label>
                            <input type="text" id="fullname" name="fullname" required>
                        </div>

                        <div class="form-group">
                            <label for="email">Email Address *</label>
                            <input type="email" id="email" name="email" required>
                        </div>

                        <div class="form-group">
                            <label for="mobile">Mobile Number *</label>
                            <input type="tel" id="mobile" name="mobile" required>
                        </div>

                        <div class="form-group">
                            <label for="address">Address / City *</label>
                            <textarea id="address" name="address" rows="3" required></textarea>
                        </div>

                        <div class="form-group">
                            <label for="qualification">Qualification *</label>
                            <select id="qualification" name="qualification" required>
                                <option value="">Select your qualification</option>
                                <option value="Below 12th">Below 12th</option>
                                <option value="12th Pass">12th Pass</option>
                                <option value="Diploma">Diploma</option>
                                <option value="Graduate">Graduate</option>
                                <option value="Post Graduate">Post Graduate</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-section">
                        <h2>Course Selection</h2>
                        <p class="form-hint">Select one or more courses</p>

                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" name="courses[]" value="Sewing">
                                <span>Sewing</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="courses[]" value="Pattern Making">
                                <span>Pattern Making</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="courses[]" value="Draping">
                                <span>Draping</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="courses[]" value="Fashion Illustration">
                                <span>Fashion Illustration</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="courses[]" value="Tie and Dye">
                                <span>Tie and Dye</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="courses[]" value="Embroidery">
                                <span>Embroidery</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="courses[]" value="Drawing and Painting">
                                <span>Drawing and Painting</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="courses[]" value="Pencil Shading">
                                <span>Pencil Shading</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="terms-section">
                            <label class="checkbox-label">
                                <input type="checkbox" id="terms" name="terms" required>
                                <span>I agree to the <a href="rules.html" target="_blank">Terms and Conditions</a>
                                    *</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary btn-large">Submit Application</button>
                    </div>

                    <div id="formMessage" class="form-message"></div>
                </form>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>AL KHAYT Fashion Training Institute</h3>
                    <p>Weaving Dreams into Design</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="courses.html">Courses</a></li>
                        <li><a href="register.html">Register</a></li>
                        <li><a href="rules.html">Rules & Regulations</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Contact</h4>
                    <p>Email: alkhayttraining@gmail.com</p>
                    <p>Phone: +974 6691 9467</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 AL KHAYT Fashion Training Institute. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- EmailJS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <!-- GSAP (optional) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

    <!-- ALL JAVASCRIPT IN ONE PLACE -->
    <script>
        // ============================================
        // FIREBASE CONFIGURATION
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyAy0TH80vX90pcVyjcwatCjsdYxLJMFOSU",
            authDomain: "al-khayt-fashion.firebaseapp.com",
            projectId: "al-khayt-fashion",
            storageBucket: "al-khayt-fashion.firebasestorage.app",
            messagingSenderId: "757987415170",
            appId: "1:757987415170:web:0a85d66e60706a94a4509b"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        console.log('âœ… Firebase initialized');

        // ============================================
        // EMAILJS CONFIGURATION
        // ============================================
        const EMAILJS_CONFIG = {
            serviceID: 'service_it02vj9',
            templateID_Student: 'template_0smnsvc',
            templateID_Admin: 'template_yqrebny',
            publicKey: 'OOC00CA4nP_aECKrL'
        };

        // Initialize EmailJS
        emailjs.init(EMAILJS_CONFIG.publicKey);
        console.log('âœ… EmailJS initialized');

        // ============================================
        // EMAIL FUNCTIONS
        // ============================================
        async function sendStudentEmail(studentData) {
            const templateParams = {
                to_name: studentData.fullname,
                to_email: studentData.email,
                student_name: studentData.fullname,
                courses: studentData.courses.join(', '),
                mobile: studentData.mobile,
                address: studentData.address,
                qualification: studentData.qualification
            };

            try {
                const response = await emailjs.send(
                    EMAILJS_CONFIG.serviceID,
                    EMAILJS_CONFIG.templateID_Student,
                    templateParams
                );
                console.log('âœ… Student email sent');
                return { success: true, response };
            } catch (error) {
                console.error('âŒ Student email error:', error);
                return { success: false, error };
            }
        }

        async function sendAdminEmail(studentData) {
            const templateParams = {
                student_name: studentData.fullname,
                student_email: studentData.email,
                student_mobile: studentData.mobile,
                student_address: studentData.address,
                student_qualification: studentData.qualification,
                courses: studentData.courses.join(', '),
                submission_date: new Date().toLocaleString()
            };

            try {
                const response = await emailjs.send(
                    EMAILJS_CONFIG.serviceID,
                    EMAILJS_CONFIG.templateID_Admin,
                    templateParams
                );
                console.log('âœ… Admin email sent');
                return { success: true, response };
            } catch (error) {
                console.error('âŒ Admin email error:', error);
                return { success: false, error };
            }
        }

        // ============================================
        // FORM HANDLER
        // ============================================
        document.addEventListener('DOMContentLoaded', function () {
            const registrationForm = document.getElementById('registrationForm');
            const formMessage = document.getElementById('formMessage');

            if (!registrationForm) {
                console.error('âŒ Form not found!');
                return;
            }

            console.log('âœ… Form handler initialized');

            registrationForm.addEventListener('submit', async function (e) {
                e.preventDefault();
                console.log('ðŸ“ Form submitted');

                // Get form data
                const formData = new FormData(registrationForm);
                const courses = formData.getAll('courses[]');

                // Validate
                if (courses.length === 0) {
                    showMessage('Please select at least one course.', 'error');
                    return;
                }

                if (!document.getElementById('terms').checked) {
                    showMessage('Please accept the Terms and Conditions.', 'error');
                    return;
                }

                // Show loading
                const submitBtn = registrationForm.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;
                submitBtn.textContent = 'Submitting...';
                submitBtn.disabled = true;

                const studentData = {
                    fullname: formData.get('fullname'),
                    email: formData.get('email'),
                    mobile: formData.get('mobile'),
                    address: formData.get('address'),
                    qualification: formData.get('qualification'),
                    courses: courses,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    status: 'pending',
                    createdAt: new Date().toISOString()
                };

                console.log('ðŸ’¾ Saving to Firebase...', studentData);

                try {
                    // Step 1: Save to Firebase (2 seconds)
                    submitBtn.textContent = 'Saving...';
                    const docRef = await db.collection('registrations').add(studentData);
                    console.log('âœ… Saved! Doc ID:', docRef.id);

                    // Step 2: Send BOTH emails at the same time (faster!)
                    submitBtn.textContent = 'Sending confirmation email...';
                    showMessage('â³ Registration saved! Sending confirmation email...', 'success');

                    const [studentResult, adminResult] = await Promise.all([
                        sendStudentEmail(studentData),
                        sendAdminEmail(studentData)
                    ]);

                    // Step 3: Check results
                    if (studentResult.success) {
                        console.log('âœ… Student email sent');
                        showMessage('âœ… Registration successful! Confirmation email sent. Check your inbox.', 'success');
                    } else {
                        console.warn('âš ï¸ Student email failed:', studentResult.error);
                        showMessage('âœ… Registration saved! Email may be delayed. We will contact you soon.', 'success');
                    }

                    if (adminResult.success) {
                        console.log('âœ… Admin email sent');
                    } else {
                        console.warn('âš ï¸ Admin email failed:', adminResult.error);
                    }

                    // Reset form
                    registrationForm.reset();

                } catch (error) {
                    console.error('âŒ Error:', error);
                    showMessage('âŒ Error: ' + error.message, 'error');
                } finally {
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                }
            });

            function showMessage(message, type) {
                formMessage.textContent = message;
                formMessage.className = 'form-message ' + type;
                formMessage.style.display = 'block';

                if (type === 'success') {
                    setTimeout(() => {
                        formMessage.style.display = 'none';
                    }, 8000);
                }
            }
        });

        // ============================================
        // MOBILE MENU (from script.js)
        // ============================================
        const hamburger = document.querySelector('.hamburger');
        const navMenu = document.querySelector('.nav-menu');

        if (hamburger && navMenu) {
            hamburger.addEventListener('click', function () {
                hamburger.classList.toggle('active');
                navMenu.classList.toggle('active');
            });
        }
    </script>
</body>

</html>